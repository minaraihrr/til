# 20251103

## todo
- N年日記テーブル設計 DONE
- postgreSQL インストール DONE
- N年日記DB作成 DONE

## テーブル設計書作成
### N年日記テーブル設計
#### diaries
| No. | カラム名 | 項目名 | データ型 | PK | NOT NULL | UNIQUE | DEFAULT | 備考 |
| ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- | ---- |
| 1 | id | キー | SERIAL | ○ | ○ | - | - | 自動採番 |
| 2 | entry_date | 日付 | DATE | - | ○ | ○ | - | - |
| 3 | content | 本文 | TEXT | - | - | - | - | - |
| 4 | created_at | 作成日時 | TIMESTAMP | - | - | - | NOW() | - |
| 5 | updated_at | 更新日時 | TIMESTAMP | - | - | - | NOW() | - |

#### sql
```sql
CREATE TABLE diaries (
    id SERIAL PRIMARY KEY,
    entry_date DATE NOT NULL UNIQUE,
    content TEXT,
    created_at TIMESTAMP DEFAULT NOW(),
    updated_at TIMESTAMP DEFAULT NOW()
);
```

### postgreSQLのテーブル設計
- 命名：慣習的にスネークケース
- データ型
    - SERIAL：自動採番。IDによく使用
    - DATE：日付のみ
    - TIMESTAMP：日付時刻
    - TEXT：可変長テキスト。varcharより長い本文などに使用

### 関数
- NOW()：現在日時。oracleのSYSDATE、SQL ServerのGETDATE()に相当

## postgreSQL インストール
- postgreSQL 18 windows インストール  
参照：https://qiita.com/Yasushi-Mo/items/c8bb9fb9ed816a5bf7a3  
- LOCALE：C を選択
- スタックビルダのインストーラが表示されたらキャンセル

### CLI利用設定
- 環境変数の設定  
検索 > env > 環境変数  
- cmd > `psql --version` して表示されたら環境変数の設定OK
- 起動方法：`psql -d DB名 -u ユーザー名` > パスワード入力 > SQL入力できる
- インストール時にパスワード設定したsuperuserのユーザー名はpostgres
- 切断：\q

### pgadmin(GUIコンソール)設定
- 日本語設定：ファイル > 設定 > その他 > User Interface > Language > Japanese > 左上のフロッピーボタンで保存
- データベース作成：サーバー名 > データベース右クリック
- テーブル確認：DB名 > スキーマ > テーブル > テーブル名

## postgreSQL / Node.js 接続
### カレントディレクトリ以外の.envファイル読み込み
- カレントディレクトリの場合
    ```
    import 'dotenv/config';
    import pkg from 'pg';
    const { Pool } = pkg;

    const pool = new Pool({
        user: process.env.PGUSER,
        host: process.env.PGHOST,
        database: process.env.PGDATABASE,
        password: process.env.PGPASSWORD,
        port: process.env.PGPORT,
    });

    export default pool;
    ```
- ディレクトリ指定する場合
    ```
    import dotenv from 'dotenv';
    import path from 'node:path';
    import { fileURLToPath } from 'node:url';
    import pkg from 'pg';
    const { Pool } = pkg;

    const __dirname = path.dirname(fileURLToPath(import.meta.url));
    dotenv.config({ path: path.resolve(__dirname, '../.env') });

    const pool = new Pool({
        host: process.env.PGHOST,
        user: process.env.PGUSER,
        database: process.env.PGDATABASE,
        password: process.env.PGPASSWORD,
        port: process.env.PGPORT,
    });

    export default pool;
    ```